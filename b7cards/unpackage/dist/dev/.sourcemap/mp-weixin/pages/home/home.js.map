{"version":3,"file":"home.js","sources":["pages/home/home.vue","../../down load/HBuilderX.4.76.2025082103/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaG9tZS9ob21lLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n\t<button @click=\"SynInformation\" :disabled = \"!canbutton\"> 同步信息 </button>\n\t<button @click=\"gameStart\" :disabled = \"!isConnected && !canbutton\"> 开始游戏 </button>\n    \n    <!-- 玩家列表 -->\n    <view class=\"player-section\">\n      <h3>在线玩家 ({{ playerlist.length }})</h3>\n      <ul>\n        <li v-for=\"(item, index) in playerlist\" :key=\"index\">\n          玩家{{ index+1 }}: {{ item.deviceId || item }}\n        </li>\n      </ul>\n    </view>\n    \n    <!-- 玩家手牌 -->\n    <view class=\"cards-section\" v-if=\"playerCards.length > 0\">\n      <h3>你的手牌 ({{ playerCards.length }}张)</h3>\n      \n      <!-- 选中的牌 -->\n      <view class=\"selected-section\" v-if=\"selectedCard\">\n        <h4>已选牌</h4>\n        <view class=\"selected-cards\">\n          <view class=\"card-item\">\n            <view :class=\"['card', 'card-' + selectedCard.suit, 'selected']\">\n              <text class=\"card-rank\">{{ selectedCard.rank }}</text>\n              <text class=\"card-suit\">{{ getSuitSymbol(selectedCard.suit) }}</text>\n            </view>\n          </view>\n        </view>\n        <view class=\"action-buttons\">\n          <button @click=\"playCard\" class=\"play-btn\">出牌</button>\n          <button @click=\"clearSelection\" class=\"clear-btn\">取消选择</button>\n        </view>\n      </view>\n      \n      <!-- 所有手牌 -->\n      <view class=\"cards-container\">\n        <view v-for=\"(card, index) in playerCards\" :key=\"index\" class=\"card-item\">\n          <view \n            :class=\"['card', 'card-' + card.suit, selectedCard && selectedCard.id === card.id ? 'selected' : '']\"\n            @click=\"selectCard(card)\"\n          >\n            <text class=\"card-rank\">{{ card.rank }}</text>\n            <text class=\"card-suit\">{{ getSuitSymbol(card.suit) }}</text>\n            <text v-if=\"selectedCard && selectedCard.id === card.id\" class=\"selected-mark\">✓</text>\n          </view>\n        </view>\n      </view>\n    </view>\n    \n  </view>\n</template>\n\n<script>\n\n\nconst app = getApp();\nexport default {\n  \n\tdata(){\n\t\treturn{\n\t\t\tcanbutton : false,\n\t\t\tisConnected : false ,\n\t\t\tplayerlist:[],\n\t\t\tplayerCards: [],\n\t\t\tselectedCard: null, // 选中的单张牌\n\t\t\tgameStatus: 'waiting' // waiting, playing, ended\n\t\t}\n\t},\n  onLoad(){\n    this.setupWebSocketListener();\n  },\n  methods: {\n    setupWebSocketListener() {\n      if (app.globalData.socketTask && app.globalData.isConnected) {\n\t\t  console.log(\"监听器设置成功\")\n\t\t  this.canbutton = true;\n        // 设置消息监听器\n        app.globalData.socketTask.onMessage((res) => {\n          console.log('Home页面收到WebSocket消息:', res);\n          \n          try {\n            // 解析JSON消息\n            const messageData = JSON.parse(res.data);\n            if(messageData.type == 'syninformation'){\n\t\t\t\tconsole.log(\"进入到同步数组if\")\n              this.playerlist = messageData.content;\n            }\n         //----------分割每一条消息处理\n\t\t //处理开始游戏后的消息处理\n\t\t\tif(messageData.type == 'alert'){\n\t\t\t\tconsole.log(messageData.content)\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle:messageData.content,\n\t\t\t\t\ticon:'error',\n\t\t\t\t\tduration:2000\n\t\t\t\t})\n\t\t\t}\n\t\t\tif(messageData.type == \"gameStartRes\"){\n\t\t\t\tconsole.log(\"收到游戏开始响应，手牌信息:\", messageData.content);\n\t\t\t\tthis.playerCards = messageData.content.playerCards || [];\n\t\t\t\tthis.gameStatus = 'playing';\n\t\t\t\tthis.selectedCard = null;\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: `游戏开始！获得${this.playerCards.length}张牌`,\n\t\t\t\t\ticon: 'success',\n\t\t\t\t\tduration: 2000\n\t\t\t\t});\n\t\t\t}\n\t\t \n\t\t  } catch (error) {\n            console.error('消息解析失败:', error, '原始数据:', res.data);\n            // 处理非JSON格式消息\n            \n          }\n        });\n        \n        this.isListening = true;\n        console.log('Home页面WebSocket监听器已设置');\n      } else {\n        console.log('WebSocket未连接，无法设置监听器');\n        // 可以设置定时器重试\n        setTimeout(() => {\n          this.setupWebSocketListener();\n        }, 2000);\n      }\n    },\n    SynInformation(){\n\t\tconsole.log(\"是否成功连接\" + app.globalData.isConnected);\n\t\tconsole.log(\"socketTask:\" + app.globalData.socketTask);\n      if (app.globalData.isConnected && app.globalData.socketTask) {\n\t\t\t\t\tconst message = {\n\t\t\t\t\t\ttype: 'system',\n\t\t\t\t\t\treqmethoud : 'syninformation',\n\t\t\t\t\t\tplayerid : app.globalData.diviceid,\n            \n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tapp.globalData.socketTask.send({\n\t\t\t\t\t\tdata: JSON.stringify(message),\n\t\t\t\t\t\tsuccess: () => {\n\t\t\t\t\t\t\t//----------在连接成功的回调中设置监听函数-------------------------\n\t\t\t\t\t\t\tthis.isConnected = true\n\t\t\t\t\t\t\tconsole.log('同步信息成功');\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfail: (err) => {\n\t\t\t\t\t\t\tconsole.error('同步用户信息失败:', err);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: 'WebSocket未连接',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t});\n\t\t\t\t}\n    },\n    gameStart(){\n\t\tconst message = {\n\t\t\ttype: 'gameStart',\n\t\t\treqmethoud : 'user',\n\t\t\tplayerid : app.globalData.diviceid,\n\t\t            };\n\t\t\tapp.globalData.socketTask.send({\n\t\t\t\tdata: JSON.stringify(message),\n\t\t\t\tsuccess: () => {\n\t\t\t\t\t//----------在连接成功的回调中设置监听函数-------------------------\n\t\t\t\t\tthis.isConnected = true\n\t\t\t\t\tconsole.log('发送开始游戏请求');\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t},\n\t\t\t\tfail: (err) => {\n\t\t\t\t\tconsole.error('发送卡开始请求失败:', err);\n\t\t\t\t\t\t\t\n\t\t\t\t}\n\t\t\t});\n\t\t\n\t},\n    getSuitSymbol(suit) {\n      switch(suit) {\n        case 'hearts': return '♥';\n        case 'spades': return '♠';\n        case 'clubs': return '♣';\n        case 'diamonds': return '♦';\n        default: return suit;\n      }\n    },\n    // 选择单张牌\n    selectCard(card) {\n      if (this.selectedCard && this.selectedCard.id === card.id) {\n        // 如果点击的是已选中的牌，则取消选择\n        this.selectedCard = null;\n      } else {\n        // 选择新的牌\n        this.selectedCard = card;\n      }\n    },\n    // 取消选择\n    clearSelection() {\n      this.selectedCard = null;\n    },\n    // 出牌\n    playCard() {\n      if (!this.selectedCard) {\n        uni.showToast({\n          title: '请先选择要出的牌',\n          icon: 'none',\n          duration: 2000\n        });\n        return;\n      }\n      \n      console.log('出牌:', this.selectedCard);\n      \n      // 发送出牌消息到服务器\n      const message = {\n        type: 'playCard',\n        playerid: app.globalData.diviceid,\n        card: this.selectedCard\n      };\n      \n      app.globalData.socketTask.send({\n        data: JSON.stringify(message),\n        success: () => {\n          console.log('出牌成功');\n          // 从手牌中移除已出的牌\n          this.playerCards = this.playerCards.filter(card => \n            card.id !== this.selectedCard.id\n          );\n          this.selectedCard = null;\n          \n          // 检查是否获胜\n          if (this.playerCards.length === 0) {\n            this.gameStatus = 'ended';\n            uni.showToast({\n              title: '恭喜你获胜！',\n              icon: 'success',\n              duration: 3000\n            });\n          }\n        },\n        fail: (err) => {\n          console.error('出牌失败:', err);\n          uni.showToast({\n            title: '出牌失败',\n            icon: 'none',\n            duration: 2000\n          });\n        }\n      });\n    }\n    // goToTest() {\n    //   uni.navigateTo({\n    //     url: '/pages/index/index'\n    //   });\n    // }\n  }\n}\n</script>\n\n<style>\n.container {\n  padding: 20px;\n}\n.title {\n  font-size: 24px;\n  font-weight: bold;\n}\n\n.player-section {\n  margin: 20px 0;\n  padding: 15px;\n  background-color: #f5f5f5;\n  border-radius: 8px;\n}\n\n.player-section h3 {\n  margin-bottom: 10px;\n  color: #333;\n}\n\n.cards-section {\n  margin: 20px 0;\n  padding: 15px;\n  background-color: #f9f9f9;\n  border-radius: 8px;\n}\n\n.cards-section h3 {\n  margin-bottom: 15px;\n  color: #333;\n}\n\n.cards-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n}\n\n.card-item {\n  width: 60px;\n  height: 80px;\n}\n\n.card {\n  width: 100%;\n  height: 100%;\n  border: 1px solid #ccc;\n  border-radius: 5px;\n  background-color: white;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n  position: relative;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.card.selected {\n  border: 2px solid #007AFF;\n  background-color: #f0f8ff;\n  transform: translateY(-5px);\n  box-shadow: 0 4px 8px rgba(0,122,255,0.3);\n}\n\n.card-hearts {\n  color: #e74c3c;\n  border-color: #e74c3c;\n}\n\n.card-diamonds {\n  color: #e74c3c;\n  border-color: #e74c3c;\n}\n\n.card-spades {\n  color: #2c3e50;\n  border-color: #2c3e50;\n}\n\n.card-clubs {\n  color: #2c3e50;\n  border-color: #2c3e50;\n}\n\n.card-rank {\n  font-size: 16px;\n  font-weight: bold;\n}\n\n.card-suit {\n  font-size: 20px;\n  margin-top: 5px;\n}\n\n.selected-mark {\n  position: absolute;\n  top: 2px;\n  right: 2px;\n  color: #007AFF;\n  font-weight: bold;\n  font-size: 12px;\n}\n\n.selected-section {\n  margin-bottom: 20px;\n  padding: 15px;\n  background-color: #e8f4fd;\n  border-radius: 8px;\n  border: 1px solid #007AFF;\n}\n\n.selected-section h4 {\n  margin-bottom: 10px;\n  color: #007AFF;\n}\n\n.selected-cards {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  margin-bottom: 15px;\n}\n\n.action-buttons {\n  display: flex;\n  gap: 10px;\n}\n\n.play-btn {\n  background-color: #007AFF;\n  color: white;\n  border: none;\n  padding: 8px 16px;\n  border-radius: 4px;\n  font-size: 14px;\n}\n\n.clear-btn {\n  background-color: #ff6b6b;\n  color: white;\n  border: none;\n  padding: 8px 16px;\n  border-radius: 4px;\n  font-size: 14px;\n}\n\nul {\n  list-style-type: none;\n  padding: 0;\n}\n\nli {\n  padding: 5px 0;\n  border-bottom: 1px solid #eee;\n}\n</style>","import MiniProgramPage from 'E:/mino7/b7cards/pages/home/home.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}